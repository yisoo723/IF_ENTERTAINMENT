<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.common.IMypageMapper">

<update id="updateProfile">
	update 
		"USER"
	set
		user_profile = #{savedName}
	where
		user_no = #{userNo}
</update>
	<resultMap type="userVO" id="userMap">
		<id property="userNo" column="user_no"/>
		<result property="userNo" column="user_no"/>
		<result property="userId" column="user_id"/>
		<result property="userPw" column="user_pw"/>
		<result property="userName" column="user_name"/>
		<result property="userType" column="user_type"/>
		<result property="userProfile" column="user_profile"/>
		<result property="enabled" column="enabled"/>
		<result property="memberTelno" column="member_telno"/>
		<result property="memberEmail" column="member_email"/>
		<result property="memberBirth" column="member_birth"/>
		<result property="memberGender" column="member_gender"/>
		<result property="memberPostcode" column="member_postcode"/>
		<result property="memberAddress1" column="member_address1"/>
		<result property="memberAddress2" column="member_address2"/>
		<result property="memberRegdate" column="member_regdate"/>
		<result property="memberNotification" column="member_notification"/>
		<result property="memberLgnpath" column="member_lgnpath"/>
		<result property="artistBirth" column="artist_birth"/>
		<result property="artistIntro" column="artist_intro"/>
		<result property="artistFakename" column="artist_fakename"/>
		<result property="agId" column="ag_id"/>
		<result property="nsGoods" column="ns_goods"/>
		<result property="nsArtist" column="ns_artist"/>
		<result property="nsCompany" column="ns_company"/>
		<collection property="authList" resultMap="authMap"/>
	</resultMap>	
	
	<resultMap type="userAuthVO" id="authMap">
		<result property="auth" column="auth"/>
	</resultMap>

<select id="selectUserMypage" parameterType="int" resultMap="userMap">
		select
		    u.user_no, user_name, user_id, user_pw, user_type, user_profile, enabled,
		    member_telno, member_email, member_birth, member_gender, member_postcode, member_address1,
		    member_address2, member_regdate, member_notification, member_lgnpath,
		    artist_birth, artist_intro, artist_fakename, ag_id,
		    auth,
		    ns_goods, ns_artist, ns_company
		from "USER" u
		left outer join member m on(u.user_no = m.user_no)
		left outer join artist a on (u.user_no = a.user_no)
		left outer join user_auth ua on(u.user_no = ua.user_no)
		left outer join notification_setting ns on (u.user_no = ns.user_no)
		where m.member_delyn = 'N' and m.member_stopyn = 'N' and u.user_no = #{userNo}
</select>

</mapper>