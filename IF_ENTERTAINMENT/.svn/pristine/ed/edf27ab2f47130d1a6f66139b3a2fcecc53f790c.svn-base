<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<div class="gap no-gap">
	<div class="inner-bg">
		<div class="element-title">
			<h4>📰 기업소식</h4>
			<div class="col-md-12">
				<div class="buttonz">
					<div class="route-map">
						<form action="#" id="routeForm">

							<input type="text" name="searchWord" value="${searchWord }"
								placeholder="제목입력">
							<button type="button">검색하기</button>
							<button type="button" id="newBtn">글 작성</button>
						</form>
					</div>
				</div>
			</div>
		</div>
		<table class="prj-tbl striped table-responsive">
			<thead class="color">
				<tr>
					<th style="color: white;">게시글 번호</th>
					<th style="color: white;">제목</th>
					<th style="color: white;">작성일</th>
					<th style="color: white;">작성자</th>
					<th style="color: white;">삭제</th>
				</tr>
			</thead>
			<tbody>
				<c:set value="${pagingVO.dataList }" var="CompanyNewsList" />
				<c:choose>
					<c:when test="${empty CompanyNewsList }">
						<tr>
							<td colspan="5">조회하신 게시글이 존재하지 않습니다.</td>
						</tr>
					</c:when>
					<c:otherwise>
						<c:forEach items="${CompanyNewsList }" var="companyNews">
							<tr>
								<td>${companyNews.bfNo }</td>
								<td><a
									href="/entertain/company/news/detail.do?bfNo=${companyNews.bfNo }">
										${companyNews.bfTitle } </a></td>
								<td><fmt:formatDate value="${companyNews.bfRegdate }"
										pattern="yyyy-MM-dd HH:mm" /></td>
								<td><font class="badge badge-danger"
									style="font-size: 14px;"> ${companyNews.userNo } </font></td>
								<td><c:if test="${companyNews.bfDelyn eq 'Y' }">
										삭제완료
									</c:if> <c:if test="${companyNews.bfDelyn eq 'N' }">
										<span class="delete-icon">
										<a href="/entertain/company/news/delete.do?bfNo=${companyNews.bfNo}">
										<i class="icon-trash"></i>
										</a>
										</span>
									</c:if></td>
							</tr>
						</c:forEach>
					</c:otherwise>
				</c:choose>
			</tbody>
		</table>
	</div>
</div>
<div class="card-footer prod-footer clearfix" id="pagingArea">
	${pagingVO.pagingHTML }</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
	$(function() {
		var newBtn = $("#newBtn");
		var searchForm = $("#searchForm");
		var pagingArea = $("#pagingArea");

		newBtn.on("click", function() {
			location.href = "/entertain/company/news/form.do";
		});

		pagingArea.on("click", "a", function(event) {
			event.preventDefault();
			var pageNo = $(this).data("page");
			searchForm.find("#page").val(pageNo);
			searchForm.submit();
		});

	});
	
	$(document).ready(function() {
	    $(".delete-icon a").on("click", function(event) { 
	        event.preventDefault(); 
	        
	        var deleteUrl = $(this).attr('href'); 

	        Swal.fire({
	            title: '정말로 삭제하시겠습니까?',
	            text: "삭제 시 복구할 수 없습니다!",
	            icon: 'warning',
	            showCancelButton: true,
	            confirmButtonColor: '#3085d6',
	            cancelButtonColor: '#d33',
	            confirmButtonText: '예, 삭제합니다',
	            cancelButtonText: '취소'
	        }).then((result) => {
	        	
	            if (result.isConfirmed) {
	                $.ajax({
	                    url: deleteUrl,
	                    method: 'POST',
	                    success: function(data) {
	                        Swal.fire(
	                            '삭제 완료!',
	                            '항목이 성공적으로 삭제되었습니다.',
	                            'success'
	                        ).then(() => {
	                        	
	                            window.location.href = "/entertain/company/news/list.do";
	                        });
	                    },
	                    error: function(xhr, status, error) {
	                        Swal.fire(
	                            '삭제 실패!',
	                            '삭제하는 도중 오류가 발생했습니다.',
	                            'error'
	                        );
	                    }
	                });
	            }
	        });
	    });
	});
</script>