<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.goods.IGoodsMapper">

	<insert id="insertProd" parameterType="goodsVO" useGeneratedKeys="true">
	<selectKey keyProperty="goodsNo" resultType="int" order="BEFORE">
		select seq_goods.nextval from dual
	</selectKey>
	insert into goods(
		GOODS_NO, GOODS_NAME, GOODS_PRICE, GOODS_QUANTITY, GOODS_REGDATE, GOODS_MEMBERSHIP,
		GOODS_ARTIST, GOODS_DISPLAY, GOODS_THUMBNAIL, GOODS_LIMIT, GOODS_AUTOCNDTN, 
		GOODS_AUTOBUYCOUNT, GC_ID
		)values(
			#{goodsNo}, #{goodsName}, #{goodsPrice}, #{goodsQuantity}, sysdate, #{goodsMembership},
			#{goodsArtist}, #{goodsDisplay}, #{goodsThumbnail}, #{goodsLimit}, #{goodsAutocndtn},
			#{goods_Autobuycount}, #{gc_id}
		)
	</insert>

	<select id="selectAritstList" resultType="artistgroupVO">
		select AG_ID, AG_NAME, AG_DATE, AG_INTRO, AG_PROFILE, AG_DELYN
    		from ARTIST_GROUP
	</select>
	
	<select id="selectCategoryList" resultType="categoryVO">
		select GC_ID, GC_REGDATE
    		from GOODS_CATEGORY
	</select>

	<sql id="prodSearch">
		<if test="searchType != null and searchType == 'title'">
			and(goods_name like '%'||#{searchWord}||'%')
		</if>
		<if test="searchType != null and searchType == 'artist'">
			and(goods_artist like '%'||#{searchWord}||'%')
		</if>
		<if test="searchType != null and searchType == 'category'">
			and(a.GC_ID like '%'||#{searchWord}||'%')
		</if>
	</sql>

	<select id="selectProdListCount" parameterType="pagingVO" resultType="int" >
		select count(goods_no)
		from goods
		where 1=1
		<include refid="prodSearch"></include>
	</select>
	
	<select id="selectProdList" parameterType="pagingVO" resultType="goodsVO">
		select	
			b.*
		from (
			select
				a.*, row_number() over(order by a.goods_no desc) rnum
			from(	
				select 
				    GOODS_NO, GOODS_NAME, GOODS_PRICE, GOODS_QUANTITY, GOODS_REGDATE, 
				    GOODS_MEMBERSHIP, GOODS_ARTIST, GOODS_DISPLAY, GOODS_THUMBNAIL, 
				    GOODS_LIMIT, GOODS_AUTOCNDTN, GOODS_AUTOBUYCOUNT, a.GC_ID
				from GOODS a, GOODS_CATEGORY b
				where 1=1 and a.GC_ID = b.GC_ID
			<include refid="prodSearch" />
			order by goods_no desc
			) a
		) b
		<![CDATA[
		where b.rnum >= #{startRow} and b.rnum <= #{endRow}
		]]>
	</select>
</mapper>