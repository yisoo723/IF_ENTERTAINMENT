<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>





<div class="gap no-gap">
    <c:set value="등록" var="name"/>
    <c:if test="${status eq 'u' }">
        <c:set value="수정" var="name"/>
    </c:if>
    <div class="inner-bg">
        <div class="element-title">
            <h2>상품등록</h2>
        </div>
        <div class="add-prod-from">
            <form method="post" action="/goods/insert.do" id="prodForm" enctype="multipart/form-data">
                <c:if test="${status eq 'u' }">
                    <input type="hidden" name="goodsNo" value="${notice.goodsNo }">
                </c:if>
                <div class="row row-addproduct">
                    <!-- 왼쪽 섹션 시작 -->
                    <div class="col-md-4">
                        <div class="addproduct-title">
                            <span>그룹명</span>
                        </div>
                        <input type="text" id="goodsName" name="goodsName" value="${prod.goodsName}">
                        
                        <div class="addproduct-title">
                            <span>데뷔일</span>
                        </div>
                        <input type="text" id="debutDate" name="debutDate" placeholder="데뷔일 선택">
                        
                        <div class="addproduct-title">
                            <span>그룹소개</span>
                        </div>
                        <textarea class="form-control" id="goodsQuantity" name="goodsQuantity">${prod.goodsQuantity}</textarea>
                        
                        <div class="addproduct-title">
                            <span>그룹 프로필 사진</span>
                        </div>
                        <label class="fileContainer">
                            <span>찾아보기</span>
                            <input type="file" id="goodsFile" name="goodsFile" multiple="multiple" />
                        </label>
                        <div class="proddetailimg-box">
                            <img id="detailimg" alt="" src="">
                        </div>
                        <c:if test="${status eq 'u'}">
                            <c:if test="${not empty prod.goodsFileList}">
                                <c:forEach items="${prod.goodsFileList}" var="prodFile">
                                    <div class="proddetailimg-box">
                                        <img id="detailimg" alt="" src="${prodFile.gaDetailimg}">
                                    </div>
                                </c:forEach>
                            </c:if>
                        </c:if>
                    </div>
                    <!-- 왼쪽 섹션 끝 -->
                    
                    <!-- 오른쪽 섹션 시작 (비워둠) -->
                    <div class="col-md-4">
                        <div id="memberAccordion">
                            <!-- 멤버 1 -->
                            <div class="card">
                                <div class="card-header" id="headingOne">
                                    <h5 class="mb-0">
                                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                            멤버 1
                                        </button>
                                    </h5>
                                </div>

                                <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#memberAccordion">
								    <div class="card-body irFile">
								        <input type="text" id="artistFakename" class="form-control mb-2 artistFakename" placeholder="멤버명">
								        <input type="file" id="userProfile" class="form-control-file mb-2 userProfile">
								        <input type="text" id="artistBirth" class="form-control mb-2 artistBirth" placeholder="출생일">
								        <textarea class="form-control artistIntro" id="artistIntro" placeholder="소개"></textarea>
								    </div>
								</div>
                            </div>
                            <!-- 멤버 2, 3, 4 등은 위와 같은 방식으로 추가합니다. -->
                        </div>
                    </div>
                    <button type="button" id="addMemberBtn">멤버 추가하기</button>
                    
                    <!-- 오른쪽 섹션 끝 -->
                    
                </div>
                <!-- 버튼 섹션 시작 -->
                <div class="buttonz">
                    <button type="button" id="addBtn" value="${name}">등록하기</button>
                    <c:if test="${status ne 'u'}">
                         <button type="button" id="listBtn">목록</button>
                    </c:if>
                    <c:if test="${status eq 'u'}">
                        <button type="button" id="cancelBtn">등록취소</button>
                    </c:if>
                </div>
                <!-- 버튼 섹션 끝 -->
            </form>
        </div>
    </div>
</div>



<script>
function addMember() {
    var memberCount = document.querySelectorAll('#memberAccordion .card').length;
    var newMemberNumber = memberCount + 1;

    var cardDiv = document.createElement('div');
    cardDiv.className = 'card';

    var cardHeaderDiv = document.createElement('div');
    cardHeaderDiv.className = 'card-header';
    cardHeaderDiv.id = 'heading' + newMemberNumber;

    var h5 = document.createElement('h5');
    h5.className = 'mb-0';

    var button = document.createElement('button');
    button.className = 'btn btn-link collapsed';
    button.type = 'button';
    button.setAttribute('data-toggle', 'collapse');
    button.setAttribute('data-target', '#collapse' + newMemberNumber);
    button.setAttribute('aria-expanded', 'false');
    button.setAttribute('aria-controls', 'collapse' + newMemberNumber);
    button.textContent = '새 멤버';

    var collapseDiv = document.createElement('div');
    collapseDiv.id = 'collapse' + newMemberNumber;
    collapseDiv.className = 'collapse';
    collapseDiv.setAttribute('aria-labelledby', 'heading' + newMemberNumber);
    collapseDiv.setAttribute('data-parent', '#memberAccordion');

    var cardBodyDiv = document.createElement('div');
    cardBodyDiv.className = 'card-body';

    var inputName = document.createElement('input');
    inputName.type = 'text';
    inputName.className = 'form-control mb-2 artistFakename'; // 클래스 이름 수정
    inputName.placeholder = '멤버명';
    inputName.id = 'artistFakename' + newMemberNumber; // 여기에 ID 설정

    var inputFile = document.createElement('input');
    inputFile.type = 'file';
    inputFile.className = 'form-control-file mb-2 userProfile'; // 클래스 이름 수정
    inputFile.id = 'userProfile' + newMemberNumber; // 여기에 ID 설정

    var inputBirth = document.createElement('input');
    inputBirth.type = 'text';
    inputBirth.className = 'form-control mb-2 artistBirth';
    inputBirth.placeholder = '출생일';
    inputBirth.id = 'artistBirth' + newMemberNumber; // 여기에 ID 설정

    var textarea = document.createElement('textarea');
    textarea.className = 'form-control artistIntro';
    textarea.placeholder = '소개';
    textarea.id = 'artistIntro' + newMemberNumber; // 여기에 ID 설정

    cardBodyDiv.appendChild(inputName);
    cardBodyDiv.appendChild(inputFile);
    cardBodyDiv.appendChild(inputBirth);
    cardBodyDiv.appendChild(textarea);

    collapseDiv.appendChild(cardBodyDiv);

    h5.appendChild(button);

    cardHeaderDiv.appendChild(h5);

    cardDiv.appendChild(cardHeaderDiv);
    cardDiv.appendChild(collapseDiv);

    document.getElementById('memberAccordion').appendChild(cardDiv);
}


// "멤버 추가하기" 버튼에 클릭 이벤트 리스너 추가
document.getElementById('addMemberBtn').addEventListener('click', addMember);
</script>
<script>
$('#addBtn').click(function(e) {
    e.preventDefault(); // 폼의 기본 제출 동작을 막습니다.

    var formData = new FormData();
    
    // 멤버 정보를 순회하며 수집
    $('.card').each(function(index, card) {
        var artistFakename = $(card).find('.artistFakename').val();
        var artistBirth = $(card).find('.artistBirth').val();
        var artistIntro = $(card).find('.artistIntro').val();
        var userProfile = $(card).find('.userProfile')[0].files[0]; // 이미지 파일

        // 멤버별로 구분될 수 있도록 키 값을 설정
        formData.append('artistFakename[]', artistFakename);
        formData.append('artistBirth[]', artistBirth);
        formData.append('artistIntro[]', artistIntro);

        // 이미지 파일이 있을 경우에만 추가
        if (userProfile) {
            formData.append('userProfile[]', userProfile, userProfile.name);
        }
    });

    $.ajax({
        url: '/entertain/artist/profile/insert.do',
        type: 'POST',
        data: formData,
        processData: false, // jQuery가 데이터를 처리하지 않도록 설정
        contentType: false, // contentType을 false로 설정하여 jQuery가 경계 문자열을 올바르게 설정하도록 함
        success: function(data) {
            console.log("성공:", data);
            // 성공 시 추가적인 동작 구현
        },
        error: function(xhr, status, error) {
            console.error("실패:", error);
            // 실패 시 추가적인 동작 구현
        }
    });
});
</script>
<script>
    flatpickr("#debutDate", {
        altInput: true,
        altFormat: "F j, Y",
        dateFormat: "Y-m-d",
    });
</script>

