<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.or.ddit.mapper.entertain.IIRMapper">
	
	<sql id="IREventSearch">
		<if test="searchType != null and searchType == 'title'">
			and (BF_TITLE like '%'||#{searchWord}||'%')
		</if>
		<if test="searchType != null and searchType == 'writer'">
			and (USER_NO like '%'||#{searchWord}||'%')
		</if>
	</sql>
	
	<insert id="insertIREvent" parameterType="IREventVO" useGeneratedKeys="true">
	<selectKey keyProperty="bfNo" resultType="int" order="BEFORE">
			select seq_bfno.nextval from dual
	</selectKey>
      INSERT INTO BOARD_FORM
        (BF_NO, BF_TITLE, BF_CONTENT, BF_REGDATE, USER_NO, BT_NO)
        VALUES
        (#{bfNo}, #{bfTitle}, #{bfContent}, SYSDATE, #{userNo}, 4)
    </insert>
    
	<select id="selectIREventCount" parameterType="pagingVO" resultType="int">
		SELECT COUNT(BF_NO)
		FROM BOARD_FORM
		WHERE 1=1
		<include refid="IREventSearch"/>
	</select>
	
	<select id="selectIREventList" parameterType="pagingVO" resultType="noticeVO">
		select
			b.*
		from(
			select
				a.*, row_number() over(order by a.bo_no desc) rnum
			from(
				select
					bo_no, bo_title, bo_content, bo_writer, bo_date, bo_hit
				from notice
				where 1=1
				<include refid="IREventSearch"/> 
				order by bo_no desc
			) a
		)b
		<![CDATA[
			where b.rnum >= #{startRow} and b.rnum <= #{endRow}
		]]>
	</select>
	
</mapper>