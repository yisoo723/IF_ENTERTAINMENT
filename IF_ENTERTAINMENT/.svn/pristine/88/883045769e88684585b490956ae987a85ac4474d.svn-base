<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<div class="gap no-gap">
	<div class="inner-bg">
		<div class="element-title">
			<h3>ğŸ“° ê¸°ì—…ì†Œì‹</h3>
			<br />
			<div class="gap listbar-container">
				<div class="discount-copon list-bar">
					<div class="row">
						<div class="col-md-6">
							<form method="post" id="searchForm" style="display: flex;">
								<input type="hidden" name="page" id="page" /> <input
									type="text" name="searchWord" value="${searchWord}"
									placeholder="ê²€ìƒ‰" style="flex: 1; margin: 3px;">
								<button type="submit" style="margin: 3px;">ê²€ìƒ‰í•˜ê¸°</button>
								<button type="button" id="newBtn" style="margin: 3px;">ê¸€
									ì‘ì„±</button>
									<sec:csrfInput />
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="widget-title no-margin"
			style="width: 100%; text-align: center; padding: 0;">
			<table class="prj-tbl striped table-hover "
				style="width: 100%; text-align: center;">
				<thead class="color">
					<tr>
						<th style="padding-left: 0;"><em>ê²Œì‹œê¸€ ë²ˆí˜¸</em></th>
						<th><em>ì œëª©</em></th>
						<th><em>ì‘ì„±ì¼</em></th>
						<th><em>ì‘ì„±ì</em></th>
						<th style="padding-right: 0;"><em>ì‚­ì œ</em></th>
					</tr>
				</thead>
				<tbody>
					<c:set value="${pagingVO.dataList }" var="CompanyNewsList" />
					<c:choose>
						<c:when test="${empty CompanyNewsList }">
							<tr>
								<td colspan="5">ì¡°íšŒí•˜ì‹  ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</td>
							</tr>
						</c:when>
						<c:otherwise>
							<c:forEach items="${CompanyNewsList }" var="companyNews">
								<tr class="prodList">
									<td style="padding-left: 0;">${companyNews.bfNo }</td>
									<td style="text-align: left;"><a
										href="/entertain/company/news/detail.do?bfNo=${companyNews.bfNo }">
											${companyNews.bfTitle } </a></td>
									<td><fmt:formatDate value="${companyNews.bfRegdate }"
											pattern="yyyy-MM-dd HH:mm" /></td>
									<td><font class="badge badge-danger"
										style="font-size: 14px;"> ${companyNews.userNo } </font></td>
									<td style="text-align: center; padding-right: 0;"><c:choose>
											<c:when test="${companyNews.bfDelyn eq 'Y' }">
          									  ì‚­ì œì™„ë£Œ
       										 </c:when>
											<c:otherwise>
												<span class="delete-icon"> <a
													href="/entertain/company/news/delete.do?bfNo=${companyNews.bfNo}">
														<i class="icon-trash"></i>
												</a>
												</span>
											</c:otherwise>
										</c:choose></td>
								</tr>
							</c:forEach>
						</c:otherwise>
					</c:choose>
				</tbody>
			</table>
		</div>
		<div class="card-footer prod-footer clearfix" id="pagingArea">
			${pagingVO.pagingHTML }</div>
	</div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
	$(function() {
		var newBtn = $("#newBtn");
		var searchForm = $("#searchForm");
		var pagingArea = $("#pagingArea");

		newBtn.on("click", function() {
			location.href = "/entertain/company/news/form.do";
		});

		pagingArea.on("click", "a", function(event) {
			event.preventDefault();
			var pageNo = $(this).data("page");
			searchForm.find("#page").val(pageNo);
			searchForm.submit();
		});

	});
	
	$(document).ready(function() {
	    $(".delete-icon a").on("click", function(event) { 
	        event.preventDefault(); 
	        
	        var deleteUrl = $(this).attr('href'); 

	        Swal.fire({
	            title: 'ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
	            text: "ì‚­ì œ ì‹œ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!",
	            icon: 'warning',
	            showCancelButton: true,
	            confirmButtonColor: '#3085d6',
	            cancelButtonColor: '#d33',
	            confirmButtonText: 'ì˜ˆ, ì‚­ì œí•©ë‹ˆë‹¤',
	            cancelButtonText: 'ì·¨ì†Œ'
	        }).then((result) => {
	        	
	            if (result.isConfirmed) {
	                $.ajax({
	                    url: deleteUrl,
	                    beforeSend: function(xhr){
	                    	xhr.setRequestHeader(header, token);
	                    },
	                    method: 'POST',
	                    success: function(data) {
	                        Swal.fire(
	                            'ì‚­ì œ ì™„ë£Œ!',
	                            'í•­ëª©ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.',
	                            'success'
	                        ).then(() => {
	                        	
	                            window.location.href = "/entertain/company/news/list.do";
	                        });
	                    },
	                    error: function(xhr, status, error) {
	                        Swal.fire(
	                            'ì‚­ì œ ì‹¤íŒ¨!',
	                            'ì‚­ì œí•˜ëŠ” ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.',
	                            'error'
	                        );
	                    }
	                });
	            }
	        });
	    });
	});
</script>