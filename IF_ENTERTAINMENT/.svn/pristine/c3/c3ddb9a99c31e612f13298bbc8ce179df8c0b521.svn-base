<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>   
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %> 
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<title>Insert title here</title>
<style type="text/css">
.fin {
	margin-bottom: 20px;
}


</style>
</head>
<body>
<h2 style="margin-bottom: 30px">ì¬ë¬´ì •ë³´ ê´€ë¦¬</h2>
<form action="excelUp.do" method="post" id="uploadForm" enctype="multipart/form-data">
    <div id="excelTable"></div>
    <input type="file" name="upFile" id="upFile" accept=".xls, .xlsx" style="display: none;">
    <!-- Bootstrap ë° Font Awesome ì•„ì´ì½˜ì„ ì´ìš©í•œ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
    
    <div class="buttonz fin">
    
    <button type="button" id="downBtn" class="btn btn-primary">
        <i class="fas fa-download"></i> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
    </button>
    <!-- Bootstrap ë° Font Awesome ì•„ì´ì½˜ì„ ì´ìš©í•œ ì—…ë¡œë“œ ë²„íŠ¼ -->
    <button type="button" id="uploadBtn" class="btn btn-primary">
        <i class="fas fa-file-excel"></i> ì—‘ì…€ ì—…ë¡œë“œ
    </button>
    </div>
    <div id="result"></div>
    <sec:csrfInput/>
</form>

<div style="text-align: left; display: inline-block; width: 50%;">ì¬ë¬´ìƒíƒœí‘œ</div>
<div style="text-align: right; display: inline-block; width: 49%;">ğŸ’µë‹¨ìœ„ : ì–µì›</div>
<div>
   <table class="table table-striped">
        <tr>
            <th>ì—°ë„</th>
            <c:forEach var="item" items="${list}">
                <th>${item.fiYear}</th>
            </c:forEach>
        </tr>
        <tr>
            <td>ìì‚°ì´ê³„</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiAsset}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ìœ ë™ìì‚°</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiCasset}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ë¹„ìœ ë™ìì‚°</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiNasset}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ë¶€ì±„ì´ê³„</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiLiabilities}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ìœ ë™ë¶€ì±„</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiCliabilities}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ë¹„ìœ ë™ë¶€ì±„</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiNliabilities}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ìë³¸ì´ê³„</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiTotalcapital}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ì§€ë°°ê¸°ì—…ì£¼ì£¼ì§€ë¶„</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiPcse}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ìë³¸ê¸ˆ</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiCapital}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ì£¼ì‹ë°œí–‰ì´ˆê³¼ê¸ˆ</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiSis}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ê¸°íƒ€ìë³¸</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiOthercapital}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ê¸°íƒ€í¬ê´„ì†ìµëˆ„ê³„ì•¡</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiAoci}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ì´ìµì‰ì—¬ê¸ˆ</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiRe}</td>
            </c:forEach>
        </tr>
        <tr>
            <td>ë¹„ì§€ë°°ì§€ë¶„</td>
            <c:forEach var="item" items="${list}">
                <td>${item.fiNci}</td>
            </c:forEach>
        </tr>
    </table>
    </div>
</body>
<script type="text/javascript">
var header = "";
var token = "";
header = $("meta[name='_csrf_header']").attr("content");
token = $("meta[name='_csrf']").attr("content");
$(function(){
	let upFile = $("#upFile")[0];
	var downBtn = $("#downBtn");
	
	// ì—¬ê¸°ì„œëŠ” jQuery ê°ì²´ì¸ downBtnì— ì§ì ‘ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
	downBtn.on("click", function(){
		location.href = "/entertain/finance/home.do";
	});
	
	upFile.addEventListener("change", function(){
		let form = $("#uploadForm")[0];
		let formData = new FormData(form);
		
		formData.append("upFile", upFile.files[0]);
		
		$.ajax({
			type : "post",
			url : "/entertain/finance/insert.do",
			processData : false,
			contentType : false,
			cache : false,
			data : formData,
			beforeSend: function(xhr){
				xhr.setRequestHeader(header, token);
			},
			success: function(response) {
			    console.log(response.dataList);
			    if (response.status === "success") {
			        Swal.fire({
			            icon: "success",
			            title: "ì—…ë¡œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
			            showConfirmButton: false,
			            timer: 1500 // 1.5ì´ˆ ë™ì•ˆ ì•ŒëŸ¬íŠ¸ ì°½ í‘œì‹œ
			        }).then(() => {
			            window.location.reload(); // ì•ŒëŸ¬íŠ¸ ì°½ì´ ë‹«íŒ ì§í›„ í˜ì´ì§€ ë¦¬ë¡œë“œ
			        });
			    } else {
			        alert("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨");
			    }
			},

			error: function (xhr, status, error) {
		        console.error(xhr.responseText);
		        alert("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨");
		    }
		});
	});
});

</script>
<script type="text/javascript">
document.getElementById('uploadBtn').onclick = function() {
    document.getElementById('upFile').click();
};

document.getElementById('upFile').onchange = function() {
    var fileName = document.getElementById('upFile').value.split('\\').pop();
    document.getElementById('uploadBtn').textContent = fileName ? "ì„ íƒëœ íŒŒì¼: " + fileName : "ì¬ë¬´ì¬í‘œ ì—…ë¡œë“œ í•˜ê¸°";
};
</script>
</html>