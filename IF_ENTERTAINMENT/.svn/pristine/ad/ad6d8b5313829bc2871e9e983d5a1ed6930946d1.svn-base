<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.10/dist/sweetalert2.min.js"></script>
<script src="${pageContext.request.contextPath }/resources/sweetAlertCustom/sweetAlertCustom.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<style>

</style>
<div class="gap inner-bg">
  <div class="table-styles">
  
  <div class="little-heading">
  	<h2 style="margin-bottom: 30px; font-family: 'GmarketSansMedium';">ğŸ–ï¸ ìƒí’ˆ ì·¨ì†Œ ë‚´ì—­</h2>
  </div>
  
  	<div class="gap listbar-container">
    <div class="discount-copon list-bar">
      <div class="row">
        <div class="col-md-4" style="margin-right: 20px;">
          <form method="post" id="searchForm">
	        <input type="hidden" name="page" id="page"/>
          	<div class="searchform-box" style="display: flex">
	          	 <select>
		            <option value="orderNo" <c:if test="${searchType eq 'orderNo' }">selected</c:if>>ì£¼ë¬¸ë²ˆí˜¸</option>
		            <option value="userId" <c:if test="${searchType eq 'userId' }">selected</c:if>>ì£¼ë¬¸ìì•„ì´ë””</option>
	        	</select>

	            <input type="text" name="searchWord" value="${searchWord }" placeholder="ê²€ìƒ‰">
		          
		        <button type="submit">ê²€ìƒ‰</button>
	          </div>
	          <sec:csrfInput/>
          </form>
        </div>
        <!-- <div class="col-md-3" style="display: flex; max-width: 13%;">
        	<form>
        	<button type="submit" style="width: 150px">ì„ íƒí•­ëª© ì‚­ì œí•˜ê¸°</button>
        	</form>
        	<form style="width: 50%;">
        	<button type="button" id="newBtn"><i class="fa-solid fa-plus"></i>ë“±ë¡í•˜ê¸°</button>
        	</form>
        </div> -->
      </div>
    </div>
  </div>
    
    <div class="widget">
    	<div class="totalCount" style="margin-top: 20px; height: 40px;">
        	<span style="font-weight: 600; color: red; padding: 20px 0px 10px 20px;">ì´ ì·¨ì†Œ ê±´ ìˆ˜ : ${pagingVO.totalRecord }</span>
       	</div>
      <table class="prj-tbl striped table-responsive">
        <thead class="color">
           <tr class="prodTitle">
             <th><em>ë²ˆí˜¸</em></th>
             <th><em>ì´ë¯¸ì§€</em></th>
             <th><em>ì œí’ˆëª…</em></th>
             <th><em>ìˆ˜ëŸ‰</em></th>
             <th><em>ê°€ê²©(ì›)</em></th>
             <th><em>ì´ì£¼ë¬¸ì•¡(ì›)</em></th>
             <th><em>ì£¼ë¬¸ì</em></th>
             <th><em>ê²°ì œë°©ë²•</em></th>
             <th><em>ì£¼ë¬¸ì¼ì</em></th>
             <th><em>ì·¨ì†Œì¼ì</em></th>
             <th><em>ìƒíƒœ</em></th>
           </tr>
        </thead>
        <tbody id="cancelTable">
        <c:set value="${pagingVO.dataList }" var="cancelList"/>
        <c:choose>
        	<c:when test="${empty cancelList}">
        		<tr>
        			<td colspan="12">ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</td>
        		</tr>
        	</c:when>
        	<c:otherwise>
        		<c:forEach items="${cancelList }" var="cancel" varStatus="vs1">
       				<span class="guidate" style="display: none;">${cancel.guiDate }</span>
       				<span class="guireason" style="display: none;">${cancel.guiReason  }</span>
       				<span class="guidetail" style="display: none;">${cancel.guiDetail  }</span>
        			<c:forEach items="${cancel.orderDetailList }" var="cancelDetail" varStatus="vs2">
	        			<tr class="cancelList" >
	        				<c:if test="${vs2.index eq 0 }">
					            <td rowspan="${fn:length(cancel.orderDetailList) }"><span>${cancel.orderNo }</span></td>
	        				</c:if>
				            
				            <td>
				            	<img alt="" src="${cancelDetail.goodsThumbnail }"  style="width:40px;">
				            </td>
				            <td style="text-align: left;">
				            	<a class="goodsBtn" data-prodNo="${cancelDetail.goodsNo }">
				            		<span>${cancelDetail.goodsName }</span>
				            	</a>
				            </td>
				            <td><span>${cancelDetail.odQuantity }</span></td>
				            <td><span><fmt:formatNumber value="${cancelDetail.odTotalprice }" pattern="#,###"/></span></td>
				            
				            <c:if test="${vs2.index eq 0 }">
					            <td rowspan="${fn:length(cancel.orderDetailList) }"><span>
					            	<fmt:formatNumber value="${cancel.orderTotalprice }" pattern="#,###"/>
					            	</span>
					            </td>
					            
					            <td rowspan="${fn:length(cancel.orderDetailList) }"><span>${cancel.userId }</span></td>
					            <td rowspan="${fn:length(cancel.orderDetailList) }"><span>${cancel.orderPay }</span></td>
					            <td rowspan="${fn:length(cancel.orderDetailList) }">
					            	<fmt:parseDate value="${cancel.orderDate}" var="orderDate" pattern="yyyy-MM-dd" />
					            	<span><fmt:formatDate value="${orderDate}" pattern="yyyy-MM-dd" /></span>
					            </td>
					            <td rowspan="${fn:length(cancel.orderDetailList) }"><span><fmt:formatDate value="${cancel.guiDate}" pattern="yyyy-MM-dd" /></span></td>
					            <td rowspan="${fn:length(cancel.orderDetailList) }">
					            	<span>
						            	<a type="button" class="detailBtn" data-index="${vs1.index}">ìì„¸íˆ ë³´ê¸°
						            	</a>
					            	</span>
					            </td>
				            </c:if>
						</tr>
        			</c:forEach>
        		</c:forEach>
        	</c:otherwise>
        </c:choose>
        </tbody> 
      </table>
    </div>
    <div class="card-footer prod-footer clearfix" id="pagingArea">
		${pagingVO.pagingHTML }
	</div>
  </div>
</div>

<!-- ëª¨ë‹¬ì‹œì‘ -->
<div class="modal fade" id="inputModal" tabindex="-1" aria-labelledby="inputModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-di">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inputModalLabel">ì·¨ì†Œ ìƒì„¸ì •ë³´</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body mb">
			    <div class="form-group inquiry">
			        <div class="inq">
			            <label>ì²˜ë¦¬ì¼ì  :&nbsp</label>
			            <span class="guiDate"></span>
			        </div>
		       		<hr>
			        <div class="inq inq_con">
			            <div><label style="width: 83px;">ì‚¬ìœ   :&nbsp</label></div>
			            <div><span class="guiReason"></span></div>
			        </div>
		       		<hr>
			        <div class="inq">
			            <label>ì‚¬ìœ  ìƒì„¸  :&nbsp</label>
			            <span class="guiDetail"></span>
			        </div>
		    	</div>
			</div>
            <div class="modal-footer mf">
                <button id="cancelBtn" type="button" class="btn btn-secondary" data-dismiss="modal">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>
</div>
<!-- ëª¨ë‹¬ ë -->
<script src="${pageContext.request.contextPath }/resources/js1/bootstrap.min.js"></script>
<script>
$(function () {
	var prod_update = $(".prod_update");
	
	prod_update.on("click", function () {
	    var prodNo = $(this).data("prodno"); 
	    location.href = "/goods/update.do?goodsNo=" + prodNo;
	});

	$('.all-slct').on("click",function(){
		$(this).toggleClass('active');
	    $(".sngl-slct").toggleClass('active'); 
	});
	
	$('.sngl-slct').on("click",function(){
		$(this).toggleClass('active'); 
	});
	
	var searchForm = $("#searchForm")
	var pagingArea = $("#pagingArea");
	
	pagingArea.on("click", "a", function (event) {
		event.preventDefault();
		var pageNo = $(this).data("page");
		searchForm.find("#page").val(pageNo);
		searchForm.submit();
	});
	
	var detailBtn = $(".detailBtn");
	
	detailBtn.on("click", function () {
		var index = $(this).data("index");
		
		var date = $(".guidate").eq(index).text();
		var reason = $(".guireason").eq(index).text();
		if (reason == "Payment") {
			$(".guiReason").text("ê²°ì œìˆ˜ë‹¨ ë³€ê²½");
		}else if (reason == "simple") {
			$(".guiReason").text("ë‹¨ìˆœ ë³€ì‹¬");
		}else if (reason == "mistake") {
			$(".guiReason").text("ì£¼ë¬¸ì°©ì˜¤");
		}else {
			$(".guiReason").text("ê¸°íƒ€");
		}
		var detail = $(".guidetail").eq(index).text();
		
		console.log("date", date);
		console.log("reason", reason);
		console.log("detail", detail);
		
		$(".guiDate").text(date);
		$(".guiDetail").text(detail);
 		modal.modal('show'); 
	});
	
	var modal = $("#inputModal"); 
	
	modal.on('show.bs.modal', function () {     
         var modal = $(this);
         modal.appendTo('body');
    });
	
});
</script>