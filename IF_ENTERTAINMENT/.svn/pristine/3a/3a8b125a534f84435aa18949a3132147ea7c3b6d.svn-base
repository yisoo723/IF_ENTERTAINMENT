<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.community.IMemberManageMapper">

	<sql id="memberListSearch">
		<if test="searchType != null and searchWord == 'title'">
			and(user_name like '%' || #{searchWord} || '%')
		</if>
	</sql>


	<select id="selectMemberCount" parameterType="pagingVO" resultType="int" >
		select count(user_no)
		from "USER"
		<include refid="memberListSearch"/>
	</select>
	
	<select id="memberList" parameterType="pagingVO" resultType="userVO">
		SELECT
	    *
		FROM (
		    SELECT
		        a.*,
		        ROW_NUMBER() OVER (ORDER BY a.USER_NO DESC) AS rnum
		    FROM (
		        SELECT
		            u.USER_NO,
		            u.USER_NAME,
		            u.USER_ID,
		            m.MEMBER_TELNO,
		            m.MEMBER_EMAIL,
		            m.MEMBER_BIRTH,
		            m.MEMBER_REGDATE,
		            m.MEMBER_STOPYN
		        FROM
		            "USER" u
		        JOIN
		            MEMBER m ON u.USER_NO = m.USER_NO
		    ) a
		) b
		<![CDATA[
		WHERE
		    b.rnum >= #{startRow} AND b.rnum <= #{endRow}
		]]>
	</select>
	
	<select id="selectFeedReportCount" parameterType="pagingVO" resultType="int">
		select count(report_no)
		from report
		<include refid="memberListSearch"/>
	</select>
	
	<select id="feedReportList" parameterType="pagingVO" resultType="feedReportVO">
		select
		b.*
		from(
			select
				a.*, row_number() over(order by report_no desc) rnum
			from(
				select 
					r.report_no
					, report_date
					, report_type
					, report_reason
					, f.feed_content
					, f.feed_no
					, f.user_no
					, user_id
				from  
				    report r
				    , feed f
				    , "USER" u  
				    where r.feed_no = f.feed_no
				    and f.user_no = u.user_no
					<include refid="memberListSearch"/>
					
			)a
		)b
		<![CDATA[
		where b.rnum >= #{startRow} and b.rnum <= #{endRow}
		]]>
	</select>


</mapper>