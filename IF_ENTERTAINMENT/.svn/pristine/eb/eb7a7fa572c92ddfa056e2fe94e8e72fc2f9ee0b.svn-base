package kr.or.ddit.controller.community;

import javax.inject.Inject;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import kr.or.ddit.service.community.IFeedService;
import kr.or.ddit.util.ServiceResult;
import lombok.extern.slf4j.Slf4j;

/**
 * 피드 좋아요 컨트롤러
 * @author 임민혁
 */
@Controller
@Slf4j
@RequestMapping("/community/feed")
public class FeedLikeController {

	@Inject
	private IFeedService feedService;
	
	@GetMapping("/like/count")
	@ResponseBody
	public ResponseEntity<Integer> getLikeCount(@RequestParam("feedNo") int feedNo) {
	    int likeCount = feedService.getLikeCount(feedNo);
	    return new ResponseEntity<>(likeCount, HttpStatus.OK);
	}

	
	@PostMapping("/like")
	@ResponseBody
	public ResponseEntity<String> likeFeed(@RequestParam("feedNo") int feedNo,
	                                       @RequestParam("userNo") int userNo) {
	    String likeCheck = feedService.alreadyLiked(feedNo, userNo);
	    System.out.println("likeCheck"+likeCheck);
	    boolean alreadyLiked = (likeCheck != null); 
	    System.out.println("alreadyLiked"+alreadyLiked);
	    if (alreadyLiked) {
	    	feedService.deleteLike(feedNo,userNo);
	        return new ResponseEntity<>("already_liked", HttpStatus.OK);
	    }

	    ServiceResult result = feedService.likePost(feedNo, userNo);

	    if (result.equals(ServiceResult.OK)) {
	        return new ResponseEntity<>("success", HttpStatus.OK);
	    } else {
	        return new ResponseEntity<>("failed", HttpStatus.INTERNAL_SERVER_ERROR);
	    }
	}
	

}