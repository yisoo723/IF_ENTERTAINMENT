<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@ taglib uri="http://www.springframework.org/security/tags" prefix="sec" %>

<style>
	#popInput {
		position: relative;
	    left: 5px;
	    top: 2px;
	}
	.popupFooter {
		position: relative;
		left: 285px;
	}
	#popupTitle {
		font-size: larger;
		font-weight: bolder;
	}
	.modal-dialog {
	    max-width: 800px;
	    margin: 6.75rem auto;
	}
	#modalBtn {
		border-radius: 25px;
	}
	.modal-body{
		min-height: 500px;
		max-height: 700px;
		overflow-y: auto;
	}
	.sqTitles{
		font-size: x-large;
	}
	.sqTypes{
		font-size: smaller;
		color: gray;
	}
	.options {
		position: relative;
		bottom: 4px;
	}
	.widget {
		background-color: aliceblue;
		margin: 10px 0;
		padding-top: 20px;
	}
	.nav-list {
		display: none;
	}
	
	.background-gradient {
		display: none;
	}
	
	.img-fluid, .slick-slide-item {
		height: 140px; 
		width: 380px;
 		object-fit: cover;
	}
	.img-fluid{
		object-fit: cover;
	}
	
	.pod-caro1, .pod-caro2, .pod-caro3 {
    display: inline-block;
    width: 160%;
    position: relative;
    margin-left: -390px;
    margin-bottom: 30px;
    object-fit: cover;
	}

</style>
<sec:authorize access="isAuthenticated()">
	<sec:authentication property="principal.user.userId" var="idInfo"/>
</sec:authorize>
<%-- <h1>${userNo }</h1> --%>
<div class="pod-featurs">
	<div class="pod-caro1">
		<div class="slick-slide-item">
			<a href="#" title=""> <img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_1.jpg"
				class="img-fluid" style="width: 340px;">
			</a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""> <img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_2.jpg"
				class="img-fluid" style="width: 340px;">
			</a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_3.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_4.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_5.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_6.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_7.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
	</div>
	<div class="pod-caro2">
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_8.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_9.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_10.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_11.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>

		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_12.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>

		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_13.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_14.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
	</div>
	<div class="pod-caro3">
		<div class="slick-slide-item">
			<a href="#" title="">
				<img src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_15.jpg"
				class="img-fluid" style="width: 340px;">
			</a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_16.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_17.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_18.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_19.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_20.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
		<div class="slick-slide-item">
			<a href="#" title=""><img
				src="${pageContext.request.contextPath }/resources/mainArtImg/feedMain_21.jpg"
				class="img-fluid" style="width: 340px;"></a>
		</div>
	</div>
</div>

<c:if test="${not empty idInfo}">
    <div class="central-meta" style="margin-bottom: 50px; border:none;">
        <div class="row remove-ext-40">
            <c:if test="${not empty mycommunityList}">
                <div class="col-lg-12">
                    <h3 style="margin-bottom:20px;">ğŸ’œ ë‚´ê°€ ê°€ì…í•œ ì»¤ë®¤ë‹ˆí‹°</h3>
                </div>
                <c:forEach items="${mycommunityList}" var="mycommunity" varStatus="idx">
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <div class="game-box">
                            <div class="memberships" style="width:100%; height: 250px;">
                                <a href="#" title="" class="myimage-link" data-artist-id="${mycommunity.agId}" style="position: relative;">
                                    <img src="${pageContext.request.contextPath}/resources/artImg/${mycommunity.agProfile}"
                                         style="width: 100%; height: 250px; object-fit: cover;">
                                </a>
                            </div>
                            <div class="game-meta">
                                <h5><a href="#" title="">${mycommunity.agId}</a></h5>
                            </div>
                        </div>
                    </div>
                </c:forEach>
            </c:if>
        </div>
    </div>    
</c:if>

 
<div class="central-meta" style="margin-bottom: 50px; border:none;">
    <div class="row remove-ext-40">
        <div class="col-lg-12">
            <h3 style="margin-bottom:20px;">ğŸ’œ ìƒˆë¡œìš´ ì•„í‹°ìŠ¤íŠ¸ë“¤ì„ ë§Œë‚˜ë³´ì„¸ìš” ! </h3>
        </div>
        <c:forEach items="${artistList}" var="artistGroup" varStatus="loop">
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="game-box">
                    <figure class="image-container">
                        <a href="#" title="" class="image-link" data-artist-id="${artistGroup.agId}" style="position: relative;">
                            <img src="${pageContext.request.contextPath }/resources/artImg/${artistGroup.agProfile}" alt="Artist Profile" style="width: 100%; height: 250px; object-fit: cover;">
                        </a>
                        <div class="join-button" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0;"><i class="fa fa-plus-square"></i>ê°€ì…í•˜ê¸°</div>
                    </figure>
                    <div class="game-meta">
                        <h5><a href="#" title="" style="font-size: 23px; font-weight: bold;">${artistGroup.agId}</a></h5>
                    </div>
                </div>
            </div>
            <c:if test="${loop.index % 4 == 3}">
                <div class="w-100"></div> 
            </c:if>
        </c:forEach>
    </div>
</div>


<!-- ì„¤ë¬¸ì¡°ì‚¬ íŒì—… ëª¨ë‹¬ì‹œì‘ -->
<c:if test="${not empty surveyPopupForm && not empty userVO}">
	<div class="popup-wraper2" id="surveyPopup">
		<div class="popup post-sharing">
			<span class="popup-closed"><i class="ti-close"></i></span>
			<div class="popup-meta">
				<div class="popup-head">
					<div id="popupTitle">${surveyPopupForm.sfTitle }</div>
				</div>
				<div class="postbox">
					<figure><img src="${surveyPopupForm.sfPhoto }" id="surveyImg" data-svidx="${surveyPopupForm.sfNo }"></figure>
					<div class="we-video-info">
						<div class="popupFooter">
							<span id="denyPopup">ì˜¤ëŠ˜í•˜ë£¨ ë³´ì§€ì•Šê¸°</span><input id="popInput" name="today_close1" type="checkbox">
						</div>
					</div>
				</div>
			</div>	
		</div>
	</div>
</c:if>
<!-- ì„¤ë¬¸ì¡°ì‚¬ íŒì—… ëª¨ë‹¬ë -->

<!-- ì„¤ë¬¸ì§€ ëª¨ë‹¬ -->
<div class="modal fade" id="myModal">
	<div class="modal-dialog">
		<div class="modal-content">
			<!-- ëª¨ë‹¬ í—¤ë” -->
			<div class="modal-header">
				<h4 class="modal-title">${surveyPopupForm.sfTitle }</h4>
				<button type="button" class="close" data-dismiss="modal">Ã—</button>
			</div>
			<!-- ëª¨ë‹¬ ë°”ë”” -->
			<div class="modal-body">
				<form class="c-form search" action="/community/survey/conductSurvey.do?sfNo=${surveyPopupForm.sfNo }" method="post" id="surveyConductForm">
					<c:forEach items="${surveyPopupForm.surveyQuestionList }" var="question" varStatus="qvs">
						<div class="widget">
							<input type="hidden" name="surveyResultList[${qvs.index }].sqNo" value="${question.sqNo }">
							<div>
								<label> 
									<span class="sqTitles">${question.sqTitle }</span>
									<span class="sqTypes"><c:if test="${question.sqType eq 'checkbox' }">(ì¤‘ë³µì„ íƒ ê°€ëŠ¥)</c:if></span>
								</label>
								<div class="form-radio">
									<c:forEach items="${question.optionList }" var="option" varStatus="ovs">
										<div class="radio">
											<label> 
												<input type="${question.sqType }" class="optionInputs" value="${option.soNo }" name="surveyResultList[${qvs.index }].srAnswer">
												<i class="check-box"></i> 
												<span class="options">${option.soContent }</span>
											</label>
										</div>
									</c:forEach>
								</div>
							</div>
						</div>
					</c:forEach>
					<sec:csrfInput/>
				</form>
			</div>
			<!-- ëª¨ë‹¬ í‘¸í„° -->
			<div class="modal-footer">
				<button type="button" id="modalBtn" class="btn btn-primary" data-dismiss="modal">ì œì¶œí•˜ê¸°</button>
			</div>
		</div>
	</div>
</div>
<!-- ì„¤ë¬¸ì§€ ëª¨ë‹¬ ë -->


<script type="text/javascript">
var header = "";
var token = "";
$(function () {
	// ì‹œíë¦¬í‹° ì ìš© ì‹œ, header í‚¤ ê°’ê³¼ í† í°ì„ ì„¤ì • 
	// (ë™ì  í˜ì´ì§€ë§ˆë‹¤ ì „ì—­ë³€ìˆ˜ë¡œ ì„¤ì •ëœ header, tokenì„ ê°€ì ¸ë‹¤ ì“¸ ìˆ˜ ìˆë‹¤)
	header = $("meta[name='_csrf_header']").attr("content");
	token = $("meta[name='_csrf']").attr("content");
	
	$(".myimage-link").on("click", function () {
		var agId = $(this).data("artist-id");
		window.location.href = "/community/artist?agId=" + agId;
	});
	
    $(".image-link").click(function () {
        var agId = $(this).data("artist-id"); 
        console.log("######", agId);
        window.location.href = "/community/artist?agId=" + agId;
    });
    
    // ì„¤ë¬¸ íŒì—… ì˜¤ëŠ˜í•˜ë£¨ ë³´ì§€ì•Šê¸° ê¸°ëŠ¥êµ¬í˜„
    var surveyPopup = getCookie('surveyPopup');
    
    // ë³€ìˆ˜ê°€ ì—†ì„ ê²½ìš° íŒì—… ì¶œë ¥
    if(!surveyPopup){
    	console.log("ì¿ í‚¤ê°€ ì—†ë„¤ìš”");
    	popUpAction('surveyPopup');
    }

	// ì¿ í‚¤ ì„¤ì •
	function getCookie(name){
		var nameOfCookie = name + "=";
		var x = 0;
		while(x <= document.cookie.length){
			var y = (x + nameOfCookie.length);
			
			if(document.cookie.substring(x, y) == nameOfCookie){
				if((endOfCookie = document.cookie.indexOf(";", y)) == -1)
					endOfCookie = document.cookie.length;
				return unescape(document.cookie.substring(y, endOfCookie));
			}
			
			x = document.cookie.indexOf(" ", x) + 1;
			
			if(x == 0)break;
		}
		return "";
	}

	// expiredays í›„ì˜ í´ë¦­í•œ ì‹œê°„ê¹Œì§€ ì¿ í‚¤ ì„¤ì •
	function setCookie24(name, value, expiredays){
		var todayDate = new Date();
		
		todayDate.setDate(todayDate.getDate() + expiredays);
	
	    document.cookie = name + "=" + escape(value) + "; path=/; expires=" + todayDate.toGMTString() + ";";
	}
	
	//00:00 ì‹œ ê¸°ì¤€ ì¿ í‚¤ ì„¤ì •í•˜ê¸° // expiredays ì˜ ìƒˆë²½ 00:00:00 ê¹Œì§€ ì¿ í‚¤ ì„¤ì • 
	function setCookie00(name, value, expiredays) {
	    var todayDate = new Date(); todayDate = new Date(parseInt(todayDate.getTime() / 86400000) * 86400000 + 54000000);
	
	    if (todayDate > new Date()) {
	        expiredays = expiredays - 1;
	    }
	
	    todayDate.setDate(todayDate.getDate() + expiredays);
	
	    document.cookie = name + "=" + escape(value) + "; path=/; expires=" + todayDate.toGMTString() + ";";
	}
	
	// íŒì—…ì¶œë ¥
	function popUpAction(name) {
	    // nameìœ¼ë¡œ í•´ë‹¹ íŒì—…ì°½ ì—´ê¸° 
	    $("#surveyPopup").addClass('active').css("background", "rgba(0, 0, 0, 0.4) none repeat scroll 0 0");
	    
	    setTimeout(() => {
	    	var popup = $("div[name=" + name + "]");
	    	$(popup[1]).css("display", "none");
		}, 8);
	    
	}
	
	// ë‹«ê¸°ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ 
    $('#popInput').on("click", function () {
    	$('.popup-wraper2').removeClass('active');

        // ì˜¤ëŠ˜í•˜ë£¨ ë³´ì§€ì•Šê¸° ì²´í¬ í™•ì¸ 
        if ($("input:checkbox[name=today_close1]").is(":checked") == true) {
            setCookie00('surveyPopup', "done", 1); // ì¿ í‚¤ ì„¤ì •
            console.log("ì˜¤ëŠ˜ í•˜ë£¨ ë³´ì§€ì•Šê¸° ì²´í¬ê°€ ì •ìƒì ìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŒ");
        }
    });
	
	// ì´ë¯¸ì§€ë¥¼ í´ë¦­í–ˆì„ ë•Œ ì„¤ë¬¸ì§€ ëª¨ë‹¬ì„ ë„ìš´ë‹¤.
	$("#surveyImg").on("click", function(){
		$('.popup-wraper2').removeClass('active');
		var sfNo = $(this).data("svidx");
		$("#myModal").modal();
	});
	
	// ì„¤ë¬¸ì§€ ëª¨ë‹¬ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
	$("#modalBtn").on("click", function(){
		$("#surveyConductForm").submit(); // ì„¤ë¬¸ì§€ ì œì¶œ
	});

}); // $(function) ì¢…ë£Œ



</script>








